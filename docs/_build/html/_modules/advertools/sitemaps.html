<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>advertools.sitemaps &mdash;  Python</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sphinx-thebe.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
        <script async="async" src="../../_static/sphinx-thebe.js"></script>
        <script async="async" src="https://unpkg.com/thebe@0.8.2/lib/index.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> advertools
          </a>
              <div class="version">
                0.13.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../readme.html">About advertools</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SEM</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.kw_generate.html">Generate SEM Keywords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.ad_create.html">Create Text Ads on a Large Scale</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.ad_from_string.html">Create Text Ads From Description Text</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SEO</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.robotstxt.html">robots.txt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.sitemaps.html">XML Sitemaps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.spider.html">SEO Spider / Crawler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.code_recipes.spider_strategies.html">Crawl Strategies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.header_spider.html">Crawl headers (HEAD method only)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.logs.html">Log File Analysis (experimental)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.logs.html#parse-and-analyze-crawl-logs-in-a-dataframe">Parse and Analyze Crawl Logs in a Dataframe</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.reverse_dns_lookup.html">Reverse DNS Lookup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.serp.html">Analyze Search Engine Results (SERPs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.knowledge_graph.html">Google's Knowledge Graph</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Text &amp; Content Analysis</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.urlytics.html">URL Structure Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.emoji.html">Emoji Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.extract.html">Extract Structured Entities from Text</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.stopwords.html">Stop Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.word_frequency.html">Text Analysis (absolute &amp; weighted word frequency)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.word_tokenize.html">Word Tokenization (N-grams)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Social Media</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.twitter.html">Twitter Data API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.youtube.html">YouTube Data API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Index &amp; Change Log</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../include_changelog.html">Index &amp; Change Log</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">advertools</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Module code</a> &raquo;</li>
      <li>advertools.sitemaps</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for advertools.sitemaps</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. _sitemaps:</span>

<span class="sd">Download, Parse, and Analyze XML Sitemaps</span>
<span class="sd">=========================================</span>

<span class="sd">One of the fastest and easiest ways to get insights on a website&#39;s content is</span>
<span class="sd">to simply download its XML sitemap(s).</span>

<span class="sd">Sitemaps are also important SEO tools as they reveal a lot of information about</span>
<span class="sd">the website, and help search engines in indexing those pages. You might want to</span>
<span class="sd">run an SEO audit and check if the URLs in the sitemap properly correspond to</span>
<span class="sd">the actual URLs of the site, so this would be an easy way to get them.</span>

<span class="sd">Sitemaps basically contain a log of publishing activity, and if they have rich</span>
<span class="sd">URLs then you can do some good analysis on their content over time as well.</span>

<span class="sd">The :func:`sitemap_to_df` function is very simple to use, and only requires the</span>
<span class="sd">URL of a sitemap, a sitemap index, or even a robots.txt file. It goes through</span>
<span class="sd">the sitemap(s) and returns a DataFrame containing all the tags and their</span>
<span class="sd">information.</span>

<span class="sd">*  `loc`: The location of the URLs of hte sitemaps.</span>
<span class="sd">*  `lastmod`: The datetime of the date when each URL was last modified, if</span>
<span class="sd">   available.</span>
<span class="sd">*  `sitemap`: The URL of the sitemap from which the URL on this row was</span>
<span class="sd">   retreived.</span>
<span class="sd">*  `etag`: The entity tag of the response header, if provided.</span>
<span class="sd">*  `sitemap_last_modified`: The datetime when the sitemap file was last</span>
<span class="sd">   modified, if provided.</span>
<span class="sd">*  `sitemap_size_mb`: The size of the sitemap in mega bytes</span>
<span class="sd">   (1MB = 1,024 x 1,024 bytes)</span>
<span class="sd">*  `download_date`: The datetime when the sitemap was downloaded.</span>

<span class="sd">Sitemap Index</span>
<span class="sd">-------------</span>
<span class="sd">Large websites typically have a sitmeapindex file, which contains links to all</span>
<span class="sd">other regular sitemaps that belong to the site. The :func:`sitemap_to_df`</span>
<span class="sd">function retreives all sub-sitemaps recursively by default.</span>
<span class="sd">In some cases, especially with very large sites, it might be better to first</span>
<span class="sd">get the sitemap index, explore its structure, and then decide which sitemaps</span>
<span class="sd">you want to get, or if you want them all. Even with smaller websites, it still</span>
<span class="sd">might be interesting to get the index only and see how it is structured.</span>

<span class="sd">This behavior can be modified by the ``recursive`` parameter, which is set to</span>
<span class="sd">`True` by default. Set it to `False` if you want only the index file.</span>

<span class="sd">Another interesting thing you might want to do is to provide a robots.txt URL,</span>
<span class="sd">and set `recursive=False` to get all available sitemap index files.</span>

<span class="sd">&gt;&gt;&gt; sitemap_to_df(&#39;https://example.com/robots.txt&#39;, recursive=False)</span>

<span class="sd">Let&#39;s now go through a quick example of what can be done with sitemaps. We can</span>
<span class="sd">start by getting one of the BBC&#39;s sitemaps.</span>

<span class="sd">Regular XML Sitemaps</span>
<span class="sd">--------------------</span>

<span class="sd">&gt;&gt;&gt; bbc_sitemap = sitemap_to_df(&#39;https://www.bbc.com/sitemaps/https-sitemap-com-archive-1.xml&#39;)</span>
<span class="sd">&gt;&gt;&gt; bbc_sitemap.head(10)</span>
<span class="sd">	                                                                            loc	                    lastmod	                                                       sitemap	                              etag	      sitemap_last_modified	     sitemap_size_mb	                     download_date</span>
<span class="sd">0	     https://www.bbc.com/arabic/middleeast/2009/06/090620_as_iraq_explosion_tc2	  2009-06-20 14:10:48+00:00	  https://www.bbc.com/sitemaps/https-sitemap-com-archive-1.xml	  5f78c818962d9c3656960a852a1fd9a5	  2020-05-27 14:38:31+00:00	  7.6312408447265625	  2021-01-16 20:16:34.403337+00:00</span>
<span class="sd">1	            https://www.bbc.com/arabic/middleeast/2009/06/090620_iraq_blast_tc2	  2009-06-20 21:07:43+00:00	  https://www.bbc.com/sitemaps/https-sitemap-com-archive-1.xml	  5f78c818962d9c3656960a852a1fd9a5	  2020-05-27 14:38:31+00:00	  7.6312408447265625	  2021-01-16 20:16:34.403337+00:00</span>
<span class="sd">2	            https://www.bbc.com/arabic/business/2009/06/090622_me_worldbank_tc2	  2009-06-22 12:41:48+00:00	  https://www.bbc.com/sitemaps/https-sitemap-com-archive-1.xml	  5f78c818962d9c3656960a852a1fd9a5	  2020-05-27 14:38:31+00:00	  7.6312408447265625	  2021-01-16 20:16:34.403337+00:00</span>
<span class="sd">3	  https://www.bbc.com/arabic/multimedia/2009/06/090624_me_inpictures_brazil_tc2	  2009-06-24 15:27:24+00:00	  https://www.bbc.com/sitemaps/https-sitemap-com-archive-1.xml	  5f78c818962d9c3656960a852a1fd9a5	  2020-05-27 14:38:31+00:00	  7.6312408447265625	  2021-01-16 20:16:34.403337+00:00</span>
<span class="sd">4	                     https://www.bbc.com/arabic/business/2009/06/090618_tomtest	  2009-06-18 15:32:54+00:00	  https://www.bbc.com/sitemaps/https-sitemap-com-archive-1.xml	  5f78c818962d9c3656960a852a1fd9a5	  2020-05-27 14:38:31+00:00	  7.6312408447265625	  2021-01-16 20:16:34.403337+00:00</span>
<span class="sd">5	      https://www.bbc.com/arabic/multimedia/2009/06/090625_sf_tamim_verdict_tc2	  2009-06-25 09:46:39+00:00	  https://www.bbc.com/sitemaps/https-sitemap-com-archive-1.xml	  5f78c818962d9c3656960a852a1fd9a5	  2020-05-27 14:38:31+00:00	  7.6312408447265625	  2021-01-16 20:16:34.403337+00:00</span>
<span class="sd">6	       https://www.bbc.com/arabic/middleeast/2009/06/090623_iz_cairo_russia_tc2	  2009-06-23 13:10:56+00:00	  https://www.bbc.com/sitemaps/https-sitemap-com-archive-1.xml	  5f78c818962d9c3656960a852a1fd9a5	  2020-05-27 14:38:31+00:00	  7.6312408447265625	  2021-01-16 20:16:34.403337+00:00</span>
<span class="sd">7	               https://www.bbc.com/arabic/sports/2009/06/090622_me_egypt_us_tc2	  2009-06-22 15:37:07+00:00	  https://www.bbc.com/sitemaps/https-sitemap-com-archive-1.xml	  5f78c818962d9c3656960a852a1fd9a5	  2020-05-27 14:38:31+00:00	  7.6312408447265625	  2021-01-16 20:16:34.403337+00:00</span>
<span class="sd">8	              https://www.bbc.com/arabic/sports/2009/06/090624_mz_wimbledon_tc2	  2009-06-24 13:57:18+00:00	  https://www.bbc.com/sitemaps/https-sitemap-com-archive-1.xml	  5f78c818962d9c3656960a852a1fd9a5	  2020-05-27 14:38:31+00:00	  7.6312408447265625	  2021-01-16 20:16:34.403337+00:00</span>
<span class="sd">9	    https://www.bbc.com/arabic/worldnews/2009/06/090623_mz_leaders_lifespan_tc2	  2009-06-23 13:24:23+00:00	  https://www.bbc.com/sitemaps/https-sitemap-com-archive-1.xml	  5f78c818962d9c3656960a852a1fd9a5	  2020-05-27 14:38:31+00:00	  7.6312408447265625	  2021-01-16 20:16:34.403337+00:00</span>

<span class="sd">&gt;&gt;&gt; bbc_sitemap.shape</span>
<span class="sd">(49999, 7)</span>

<span class="sd">&gt;&gt;&gt; bbc_sitemap.dtypes</span>
<span class="sd">loc                                   object</span>
<span class="sd">lastmod                  datetime64[ns, UTC]</span>
<span class="sd">sitemap                               object</span>
<span class="sd">etag                                  object</span>
<span class="sd">sitemap_last_modified    datetime64[ns, UTC]</span>
<span class="sd">sitemap_size_mb                      float64</span>
<span class="sd">download_date            datetime64[ns, UTC]</span>
<span class="sd">dtype: object</span>

<span class="sd">Since ``lastmod`` is a ``datetime`` object, we can easily use it for various</span>
<span class="sd">time-related operations.</span>
<span class="sd">Here we look at how many articles have been published (last modified) per year.</span>

<span class="sd">&gt;&gt;&gt; bbc_sitemap.set_index(&#39;lastmod&#39;).resample(&#39;A&#39;)[&#39;loc&#39;].count()</span>
<span class="sd">lastmod</span>
<span class="sd">2008-12-31 00:00:00+00:00     2261</span>
<span class="sd">2009-12-31 00:00:00+00:00    47225</span>
<span class="sd">2010-12-31 00:00:00+00:00        0</span>
<span class="sd">2011-12-31 00:00:00+00:00        0</span>
<span class="sd">2012-12-31 00:00:00+00:00        0</span>
<span class="sd">2013-12-31 00:00:00+00:00        0</span>
<span class="sd">2014-12-31 00:00:00+00:00        0</span>
<span class="sd">2015-12-31 00:00:00+00:00        0</span>
<span class="sd">2016-12-31 00:00:00+00:00        0</span>
<span class="sd">2017-12-31 00:00:00+00:00        0</span>
<span class="sd">2018-12-31 00:00:00+00:00        0</span>
<span class="sd">2019-12-31 00:00:00+00:00      481</span>
<span class="sd">2020-12-31 00:00:00+00:00       32</span>
<span class="sd">Freq: A-DEC, Name: loc, dtype: int64</span>

<span class="sd">As the majority are in 2009 with a few in other years, it seems these were</span>
<span class="sd">later updated, but we would have to check to verify (in this special case BBC&#39;s</span>
<span class="sd">URLs contain date information, which can be compared to ``lastmod`` to check if</span>
<span class="sd">there is a difference between them).</span>

<span class="sd">We can take a look at a sample of the URLs to get the URL template that they</span>
<span class="sd">use.</span>

<span class="sd">&gt;&gt;&gt; bbc_sitemap[&#39;loc&#39;].sample(10).tolist()</span>
<span class="sd">[&#39;https://www.bbc.com/russian/rolling_news/2009/06/090628_rn_pakistani_soldiries_ambush&#39;,</span>
<span class="sd"> &#39;https://www.bbc.com/urdu/pakistan/2009/04/090421_mqm_speaks_rza&#39;,</span>
<span class="sd"> &#39;https://www.bbc.com/arabic/middleeast/2009/07/090723_ae_silwan_tc2&#39;,</span>
<span class="sd"> &#39;https://www.bbc.com/portuguese/noticias/2009/07/090729_iraquerefenbritsfn&#39;,</span>
<span class="sd"> &#39;https://www.bbc.com/portuguese/noticias/2009/06/090623_egitomilitaresfn&#39;,</span>
<span class="sd"> &#39;https://www.bbc.com/portuguese/noticias/2009/03/090302_gazaconferenciaml&#39;,</span>
<span class="sd"> &#39;https://www.bbc.com/portuguese/noticias/2009/07/090715_hillary_iran_cq&#39;,</span>
<span class="sd"> &#39;https://www.bbc.com/vietnamese/culture/2009/04/090409_machienhuu_revisiting&#39;,</span>
<span class="sd"> &#39;https://www.bbc.com/portuguese/noticias/2009/05/090524_paquistaoupdateg&#39;,</span>
<span class="sd"> &#39;https://www.bbc.com/arabic/worldnews/2009/06/090629_om_pakistan_report_tc2&#39;]</span>

<span class="sd">It seems the pattern is</span>

<span class="sd">    **https://www.bbc.com/{language}/{topic}/{YYYY}/{MM}/{YYMMDD_article_title}**</span>

<span class="sd">This is quite a rich structure, full of useful information. We can easily count</span>
<span class="sd">how many articles they have by language, by splitting by &quot;/&quot; and getting the</span>
<span class="sd">elements at index three, and counting them.</span>

<span class="sd">&gt;&gt;&gt; bbc_sitemap[&#39;loc&#39;].str.split(&#39;/&#39;).str[3].value_counts()</span>
<span class="sd">russian       14022</span>
<span class="sd">persian       10968</span>
<span class="sd">portuguese     5403</span>
<span class="sd">urdu           5068</span>
<span class="sd">mundo          5065</span>
<span class="sd">vietnamese     3561</span>
<span class="sd">arabic         2984</span>
<span class="sd">hindi          1677</span>
<span class="sd">turkce          706</span>
<span class="sd">ukchina         545</span>
<span class="sd">Name: loc, dtype: int64</span>

<span class="sd">We can also get a subset of articles written in a certain language, and see how</span>
<span class="sd">many articles they publish per month, week, year, etc.</span>

<span class="sd">&gt;&gt;&gt; (bbc_sitemap[bbc_sitemap[&#39;loc&#39;]</span>
<span class="sd">...  .str.contains(&#39;/russian/&#39;)]</span>
<span class="sd">...  .set_index(&#39;lastmod&#39;)</span>
<span class="sd">...  .resample(&#39;M&#39;)[&#39;loc&#39;].count())</span>
<span class="sd">lastmod</span>
<span class="sd">2009-04-30 00:00:00+00:00    1506</span>
<span class="sd">2009-05-31 00:00:00+00:00    2910</span>
<span class="sd">2009-06-30 00:00:00+00:00    3021</span>
<span class="sd">2009-07-31 00:00:00+00:00    3250</span>
<span class="sd">2009-08-31 00:00:00+00:00    2769</span>
<span class="sd">                             ...</span>
<span class="sd">2019-09-30 00:00:00+00:00       8</span>
<span class="sd">2019-10-31 00:00:00+00:00      17</span>
<span class="sd">2019-11-30 00:00:00+00:00      11</span>
<span class="sd">2019-12-31 00:00:00+00:00      24</span>
<span class="sd">2020-01-31 00:00:00+00:00       6</span>
<span class="sd">Freq: M, Name: loc, Length: 130, dtype: int64</span>

<span class="sd">The fifth element after splitting URLs is the topic or category of the article.</span>
<span class="sd">We can do the same and count the values.</span>

<span class="sd">&gt;&gt;&gt; bbc_sitemap[&#39;loc&#39;].str.split(&#39;/&#39;).str[4].value_counts()[:30]</span>
<span class="sd">rolling_news          9044</span>
<span class="sd">world                 5050</span>
<span class="sd">noticias              4224</span>
<span class="sd">iran                  3682</span>
<span class="sd">pakistan              2103</span>
<span class="sd">afghanistan           1959</span>
<span class="sd">multimedia            1657</span>
<span class="sd">internacional         1555</span>
<span class="sd">sport                 1350</span>
<span class="sd">international         1293</span>
<span class="sd">india                 1285</span>
<span class="sd">america_latina        1274</span>
<span class="sd">business              1204</span>
<span class="sd">cultura_sociedad       913</span>
<span class="sd">middleeast             874</span>
<span class="sd">worldnews              872</span>
<span class="sd">russia                 841</span>
<span class="sd">radio                  769</span>
<span class="sd">science                755</span>
<span class="sd">football               674</span>
<span class="sd">arts                   664</span>
<span class="sd">ciencia_tecnologia     627</span>
<span class="sd">entertainment          621</span>
<span class="sd">simp                   545</span>
<span class="sd">vietnam                539</span>
<span class="sd">economia               484</span>
<span class="sd">haberler               424</span>
<span class="sd">interactivity          411</span>
<span class="sd">help                   354</span>
<span class="sd">ciencia                308</span>
<span class="sd">Name: loc, dtype: int64</span>

<span class="sd">Finally, we can take the last element after splitting, which contains the slugs</span>
<span class="sd">of the articles, replace underscores with spaces, split, concatenate all, put</span>
<span class="sd">in a ``pd.Series`` and count the values. This way we see how many times each</span>
<span class="sd">word occurred in an article.</span>

<span class="sd">&gt;&gt;&gt; (pd.Series(</span>
<span class="sd">...     bbc_sitemap[&#39;loc&#39;]</span>
<span class="sd">...     .str.split(&#39;/&#39;)</span>
<span class="sd">...     .str[-1]</span>
<span class="sd">...     .str.replace(&#39;_&#39;, &#39; &#39;)</span>
<span class="sd">...     .str.cat(sep=&#39; &#39;)</span>
<span class="sd">...     .split()</span>
<span class="sd">...    )</span>
<span class="sd">...     .value_counts()[:15])</span>
<span class="sd">rn        8808</span>
<span class="sd">tc2       3153</span>
<span class="sd">iran      1534</span>
<span class="sd">video      973</span>
<span class="sd">obama      882</span>
<span class="sd">us         862</span>
<span class="sd">china      815</span>
<span class="sd">ir88       727</span>
<span class="sd">russia     683</span>
<span class="sd">si         640</span>
<span class="sd">np         638</span>
<span class="sd">afghan     632</span>
<span class="sd">ka         565</span>
<span class="sd">an         556</span>
<span class="sd">iraq       554</span>
<span class="sd">dtype: int64</span>


<span class="sd">This was a quick overview and data preparation for a sample sitemap. Once you</span>
<span class="sd">are familiar with the sitemap&#39;s structure, you can more easily start analyzing</span>
<span class="sd">the content.</span>

<span class="sd">.. note::</span>

<span class="sd">    There is a bug currently with tags that contain multiple values in</span>
<span class="sd">    sitemaps. If an image column in a news sitemap contains multiple images,</span>
<span class="sd">    only the last one is retreived. The same applies for any other sitemap that</span>
<span class="sd">    has a tag with multiple values.</span>


<span class="sd">News Sitemaps</span>
<span class="sd">-------------</span>

<span class="sd">&gt;&gt;&gt; nyt_news = sitemap_to_df(&#39;https://www.nytimes.com/sitemaps/new/news.xml.gz&#39;)</span>
<span class="sd">&gt;&gt;&gt; nyt_news</span>
<span class="sd">	                                                                                          loc              	        lastmod       publication_name publication_language	 news_publication_date	                                                                    news_title	                                                                                                                                                                                            news_keywords	            image                                                                                                                                                                    	image_loc                                              sitemap	                              etag        sitemap_last_modified	     sitemap_size_mb	                     download_date</span>
<span class="sd">0	                            https://www.nytimes.com/live/2021/01/16/us/inauguration-day-biden	  2021-01-16 20:22:56+00:00	    The New York Times                   en	  2021-01-16T13:58:07Z	  Biden Inauguration, Trump Approval Rating and Protests: Live Weekend Updates	                                                                                                                                                                                                      nan	              nan	                                                                                                                                                                          nan	  https://www.nytimes.com/sitemaps/new/news.xml.gz	  5bfc0575bbabef04ced9f8e33e05fdcd	  2021-01-16 20:23:13+00:00	  0.6700353622436523	  2021-01-16 20:23:59.469793+00:00</span>
<span class="sd">1	           https://www.nytimes.com/live/2021/01/16/science/nasa-space-launch-rocket-fire-test	  2021-01-16 20:18:17+00:00	    The New York Times                   en	  2021-01-16T20:15:56Z	                                Live: NASA’s Space Launch System Hot-Fire Test	                                                                                                                                                                                                      nan	              nan	                                                                                                                                                                          nan	  https://www.nytimes.com/sitemaps/new/news.xml.gz	  5bfc0575bbabef04ced9f8e33e05fdcd	  2021-01-16 20:23:13+00:00	  0.6700353622436523	  2021-01-16 20:23:59.469793+00:00</span>
<span class="sd">2	  https://www.nytimes.com/interactive/2020/obituaries/people-died-coronavirus-obituaries.html	  2021-01-16 20:17:36+00:00	    The New York Times                en-US	  2020-04-16T22:28:14Z	                                                              Those We’ve Lost	                                                                                                                                                             Deaths (Obituaries), Coronavirus (2019-nCoV)	                 	                                        https://static01.nyt.com/images/2020/12/01/obituaries/25Houser/merlin_180391827_78fe8f74-0a8e-43c9-bc96-51859d84c2a5-articleLarge.jpg	  https://www.nytimes.com/sitemaps/new/news.xml.gz	  5bfc0575bbabef04ced9f8e33e05fdcd	  2021-01-16 20:23:13+00:00	  0.6700353622436523	  2021-01-16 20:23:59.469793+00:00</span>
<span class="sd">3	              https://www.nytimes.com/2021/01/16/opinion/coronavirus-biden-vaccine-covid.html	  2021-01-16 20:13:19+00:00	    The New York Times                en-US	  2021-01-16T19:30:07Z	                                           Joe Biden Actually Has a Covid Plan	                                         Coronavirus (2019-nCoV), Contact Tracing (Public Health), Vaccination and Immunization, United States Politics and Government, Biden, Joseph R Jr, United States	                 	                                  https://static01.nyt.com/images/2021/01/17/opinion/16pandemic1-print/merlin_173210889_b98256be-c87b-4a48-b3ab-14c0c064e33f-articleLarge.jpg	  https://www.nytimes.com/sitemaps/new/news.xml.gz	  5bfc0575bbabef04ced9f8e33e05fdcd	  2021-01-16 20:23:13+00:00	  0.6700353622436523	  2021-01-16 20:23:59.469793+00:00</span>
<span class="sd">4	                           https://www.nytimes.com/2021/01/13/opinion/capitol-attack-war.html	  2021-01-16 20:06:43+00:00	    The New York Times                   en	  2021-01-13T10:06:54Z	                                       Why the Capitol Riot Reminded Me of War	                                                                                                    Storming of the US Capitol (Jan, 2021), Video Recordings, Downloads and Streaming, Iraq War (2003-11)	                 	                                                                           https://static01.nyt.com/images/2021/01/18/opinion/sunday/18Ackermann/13Ackermann-articleLarge.jpg	  https://www.nytimes.com/sitemaps/new/news.xml.gz	  5bfc0575bbabef04ced9f8e33e05fdcd	  2021-01-16 20:23:13+00:00	  0.6700353622436523	  2021-01-16 20:23:59.469793+00:00</span>
<span class="sd">5	                   https://www.nytimes.com/interactive/2020/us/wyoming-coronavirus-cases.html	  2021-01-16 20:01:26+00:00	    The New York Times                en-US	  2020-04-01T15:47:57Z	                                        Wyoming Coronavirus Map and Case Count	                                                                                                                                                          Coronavirus (2019-nCoV), Wyoming, Disease Rates	                 	              https://static01.nyt.com/images/2020/03/29/us/wyoming-coronavirus-cases-promo-1585539595289/wyoming-coronavirus-cases-promo-1585539595289-articleLarge-v117.png	  https://www.nytimes.com/sitemaps/new/news.xml.gz	  5bfc0575bbabef04ced9f8e33e05fdcd	  2021-01-16 20:23:13+00:00	  0.6700353622436523	  2021-01-16 20:23:59.469793+00:00</span>
<span class="sd">6	                         https://www.nytimes.com/interactive/2020/world/coronavirus-maps.html	  2021-01-16 20:01:21+00:00	    The New York Times                en-US	  2020-01-28T22:57:20Z	                           Coronavirus World Map: Tracking the Global Outbreak	  Coronavirus (2019-nCoV), Epidemics, Centers for Disease Control and Prevention, Johns Hopkins University, Wuhan (China), China, United States, Australia, Singapore, Disease Rates, Deaths (Fatalities)	                 	        https://static01.nyt.com/images/2020/09/29/us/china-wuhan-coronavirus-maps-promo-1601396059552/china-wuhan-coronavirus-maps-promo-1601396059552-articleLarge-v354.png	  https://www.nytimes.com/sitemaps/new/news.xml.gz	  5bfc0575bbabef04ced9f8e33e05fdcd	  2021-01-16 20:23:13+00:00	  0.6700353622436523	  2021-01-16 20:23:59.469793+00:00</span>
<span class="sd">7	                 https://www.nytimes.com/interactive/2020/us/wisconsin-coronavirus-cases.html	  2021-01-16 20:01:16+00:00	    The New York Times                en-US	  2020-04-01T15:47:54Z	                                      Wisconsin Coronavirus Map and Case Count	                                                                                                                                                        Coronavirus (2019-nCoV), Wisconsin, Disease Rates	                 	          https://static01.nyt.com/images/2020/03/29/us/wisconsin-coronavirus-cases-promo-1585539580772/wisconsin-coronavirus-cases-promo-1585539580772-articleLarge-v118.png	  https://www.nytimes.com/sitemaps/new/news.xml.gz	  5bfc0575bbabef04ced9f8e33e05fdcd	  2021-01-16 20:23:13+00:00	  0.6700353622436523	  2021-01-16 20:23:59.469793+00:00</span>
<span class="sd">8	             https://www.nytimes.com/interactive/2020/us/west-virginia-coronavirus-cases.html	  2021-01-16 20:01:12+00:00	    The New York Times                en-US	  2020-04-01T15:47:51Z	                                  West Virginia Coronavirus Map and Case Count	                                                                                                                                                    Coronavirus (2019-nCoV), West Virginia, Disease Rates	                 	  https://static01.nyt.com/images/2020/03/29/us/west-virginia-coronavirus-cases-promo-1585539566313/west-virginia-coronavirus-cases-promo-1585539566313-articleLarge-v118.png	  https://www.nytimes.com/sitemaps/new/news.xml.gz	  5bfc0575bbabef04ced9f8e33e05fdcd	  2021-01-16 20:23:13+00:00	  0.6700353622436523	  2021-01-16 20:23:59.469793+00:00</span>
<span class="sd">9	                https://www.nytimes.com/interactive/2020/us/washington-coronavirus-cases.html	  2021-01-16 20:01:07+00:00	    The New York Times                en-US	  2020-04-01T15:47:47Z	                                     Washington Coronavirus Map and Case Count	                                                                                                                                               Coronavirus (2019-nCoV), Washington (State), Disease Rates	                 	        https://static01.nyt.com/images/2020/03/29/us/washington-coronavirus-cases-promo-1585539550650/washington-coronavirus-cases-promo-1585539550650-articleLarge-v116.png	  https://www.nytimes.com/sitemaps/new/news.xml.gz	  5bfc0575bbabef04ced9f8e33e05fdcd	  2021-01-16 20:23:13+00:00	  0.6700353622436523	  2021-01-16 20:23:59.469793+00:00</span>
<span class="sd">[741 rows x 13 columns]</span>

<span class="sd">Video Sitemaps</span>
<span class="sd">--------------</span>

<span class="sd">&gt;&gt;&gt; wired_video = sitemap_to_df(&#39;https://www.wired.com/video/sitemap.xml&#39;)</span>
<span class="sd">&gt;&gt;&gt; wired_video</span>
<span class="sd">                                                                                  loc                                                                                                                                                                                         video_thumbnail_loc                                         video_title                                                                                                                             video_description                                                                                          video_content_loc  video_duration       video_publication_date                                   sitemap                                   etag         sitemap_size_mb                         download_date</span>
<span class="sd">0	               https://www.wired.com/video/watch/behind-the-scenes-with-jj-abrams	               http://dwgyu36up6iuz.cloudfront.net/heru80fdn/image/upload/c_fill,d_placeholder_thescene.jpg,fl_progressive,g_face,h_180,q_80,w_320/v1389040164/wired_behind-the-scenes-with-jj-abrams.jpg	               Behind the Scenes with J.J. Abrams	       Wired magazine teams up with J.J. Abrams for the May issue. Look in on the creative process with J.J. and the edit and design teams.	                                      http://dp8hsntg6do36.cloudfront.net/5171b42ac2b4c00dd0c1ff9e/low.mp4	           205	  2009-04-20T00:00:00+00:00	  https://www.wired.com/video/sitemap.xml	  W/4eecc23d353856e29d6dae1ce42b43ba	  2.2617597579956055	  2021-01-16 20:43:37.992796+00:00</span>
<span class="sd">1	        https://www.wired.com/video/watch/trip-hop-pioneer-tricky-sweet-and-naive	        http://dwgyu36up6iuz.cloudfront.net/heru80fdn/image/upload/c_fill,d_placeholder_thescene.jpg,fl_progressive,g_face,h_180,q_80,w_320/v1389040238/wired_trip-hop-pioneer-tricky-sweet-and-naive.jpg	         Trip-Hop Pioneer Tricky: Sweet and Naive	                                             Tricky, of Massive Attack fame, shows Wired.com the ropes on becoming a musician and producer.	                                      http://dp8hsntg6do36.cloudfront.net/5171b424c2b4c00dd0c1fe4e/low.mp4	           267	  2009-04-18T00:00:00+00:00	  https://www.wired.com/video/sitemap.xml	  W/4eecc23d353856e29d6dae1ce42b43ba	  2.2617597579956055	  2021-01-16 20:43:37.992796+00:00</span>
<span class="sd">2	                      https://www.wired.com/video/watch/trash-foils-diamond-heist	                      http://dwgyu36up6iuz.cloudfront.net/heru80fdn/image/upload/c_fill,d_placeholder_thescene.jpg,fl_progressive,g_face,h_180,q_80,w_320/v1464291637/wired_trash-foils-diamond-heist.jpg	                        Trash Foils Diamond Heist	                                                                                                                  Trash Foils Diamond Heist	                                      http://dp8hsntg6do36.cloudfront.net/5171b424c2b4c00dd0c1fe3c/low.mp4	           278	  2009-03-12T04:00:00+00:00	  https://www.wired.com/video/sitemap.xml	  W/4eecc23d353856e29d6dae1ce42b43ba	  2.2617597579956055	  2021-01-16 20:43:37.992796+00:00</span>
<span class="sd">3	  https://www.wired.com/video/watch/the-toxic-cloud-emitting-portable-dry-ice-mak	  http://dwgyu36up6iuz.cloudfront.net/heru80fdn/image/upload/c_fill,d_placeholder_thescene.jpg,fl_progressive,g_face,h_180,q_80,w_320/v1389040172/wired_the-toxic-cloud-emitting-portable-dry-ice-mak.jpg	  The Toxic Cloud-Emitting Portable Dry Ice Maker	                                                                                 The Toxic Cloud-Emitting Portable Dry Ice Maker in action.	                                      http://dp8hsntg6do36.cloudfront.net/5171b424c2b4c00dd0c1fe42/low.mp4	            31	  2009-02-11T00:00:00+00:00	  https://www.wired.com/video/sitemap.xml	  W/4eecc23d353856e29d6dae1ce42b43ba	  2.2617597579956055	  2021-01-16 20:43:37.992796+00:00</span>
<span class="sd">4	                  https://www.wired.com/video/watch/chef-ferran-adria-of-el-bulli	                  http://dwgyu36up6iuz.cloudfront.net/heru80fdn/image/upload/c_fill,d_placeholder_thescene.jpg,fl_progressive,g_face,h_180,q_80,w_320/v1368475899/wired_chef-ferran-adria-of-el-bulli.jpg	                    Chef Ferran Adria of El Bulli	                                                                  Ferran Adria on why the knife is the most essential tool in your kitchen.	                                      http://dp8hsntg6do36.cloudfront.net/5171b42ec2b4c00dd0c20064/low.mp4	            72	  2008-11-25T00:00:00+00:00	  https://www.wired.com/video/sitemap.xml	  W/4eecc23d353856e29d6dae1ce42b43ba	  2.2617597579956055	  2021-01-16 20:43:37.992796+00:00</span>
<span class="sd">5	                      https://www.wired.com/video/watch/how-to-make-wired-origami	                      http://dwgyu36up6iuz.cloudfront.net/heru80fdn/image/upload/c_fill,d_placeholder_thescene.jpg,fl_progressive,g_face,h_180,q_80,w_320/v1389040170/wired_how-to-make-wired-origami.jpg	                        How To Make Wired Origami	                                                                Robert Lang explains how to fold the Wired issue 16.07 origami splash page.	                                      http://dp8hsntg6do36.cloudfront.net/5171b3cbc2b4c00dd0c1e969/low.mp4	           150	  2008-09-23T00:00:00+00:00	  https://www.wired.com/video/sitemap.xml	  W/4eecc23d353856e29d6dae1ce42b43ba	  2.2617597579956055	  2021-01-16 20:43:37.992796+00:00</span>
<span class="sd">6	                          https://www.wired.com/video/watch/clover-coffee-machine	                          http://dwgyu36up6iuz.cloudfront.net/heru80fdn/image/upload/c_fill,d_placeholder_thescene.jpg,fl_progressive,g_face,h_180,q_80,w_320/v1389040152/wired_clover-coffee-machine.jpg	                            Clover Coffee Machine	                                        Wired.com takes a look at the &#39;Clover&#39;, an $11,000 coffee machine hand-built by Stanford engineers.	                                      http://dp8hsntg6do36.cloudfront.net/5171b42ec2b4c00dd0c2005b/low.mp4	           147	  2008-09-23T00:00:00+00:00	  https://www.wired.com/video/sitemap.xml	  W/4eecc23d353856e29d6dae1ce42b43ba	  2.2617597579956055	  2021-01-16 20:43:37.992796+00:00</span>
<span class="sd">7	                      https://www.wired.com/video/watch/original-wargames-trailer	                      http://dwgyu36up6iuz.cloudfront.net/heru80fdn/image/upload/c_fill,d_placeholder_thescene.jpg,fl_progressive,g_face,h_180,q_80,w_320/v1464291813/wired_original-wargames-trailer.jpg	                        Original WarGames Trailer	                                                                                                                  Original WarGames Trailer	                                      http://dp8hsntg6do36.cloudfront.net/5171b427c2b4c00dd0c1fee7/low.mp4	           140	  2008-07-21T04:00:00+00:00	  https://www.wired.com/video/sitemap.xml	  W/4eecc23d353856e29d6dae1ce42b43ba	  2.2617597579956055	  2021-01-16 20:43:37.992796+00:00</span>
<span class="sd">8	                              https://www.wired.com/video/watch/rock-band-trailer	                              http://dwgyu36up6iuz.cloudfront.net/heru80fdn/image/upload/c_fill,d_placeholder_thescene.jpg,fl_progressive,g_face,h_180,q_80,w_320/v1464292286/wired_rock-band-trailer.jpg	                                Rock Band Trailer	                                                                                                                          Rock Band Trailer	                                      http://dp8hsntg6do36.cloudfront.net/5171b431c2b4c00dd0c20100/low.mp4	            70	  2007-09-14T04:00:00+00:00	  https://www.wired.com/video/sitemap.xml	  W/4eecc23d353856e29d6dae1ce42b43ba	  2.2617597579956055	  2021-01-16 20:43:37.992796+00:00</span>
<span class="sd">9	                           https://www.wired.com/video/watch/arrival-full-trailer	                           http://dwgyu36up6iuz.cloudfront.net/heru80fdn/image/upload/c_fill,d_placeholder_thescene.jpg,fl_progressive,g_face,h_180,q_80,w_320/v1471366897/wired_arrival-full-trailer.jpg	                         ‘Arrival’ — Full Trailer	  Louise Banks (Amy Adams) must learn to communicate with aliens to save humanity in the new film from ‘Sicario’ director Denis Villeneuve.	  http://dp8hsntg6do36.cloudfront.net/57b344f4fd2e614f99000014/1a74100f-bc1b-4279-b677-5efc301785d9low.mp4	           145	  2003-10-22T04:00:00+00:00	  https://www.wired.com/video/sitemap.xml	  W/4eecc23d353856e29d6dae1ce42b43ba	  2.2617597579956055	  2021-01-16 20:43:37.992796+00:00</span>
<span class="sd">[2343 rows x 11 columns]</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">gzip</span> <span class="kn">import</span> <span class="n">GzipFile</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">concurrent</span> <span class="kn">import</span> <span class="n">futures</span>
<span class="kn">from</span> <span class="nn">xml.etree</span> <span class="kn">import</span> <span class="n">ElementTree</span>
<span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlopen</span><span class="p">,</span> <span class="n">Request</span>

<span class="kn">from</span> <span class="nn">advertools</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">version</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;advertools-&#39;</span> <span class="o">+</span> <span class="n">version</span><span class="p">}</span>


<span class="k">def</span> <span class="nf">_sitemaps_from_robotstxt</span><span class="p">(</span><span class="n">robots_url</span><span class="p">):</span>
    <span class="n">sitemaps</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">robots_page</span> <span class="o">=</span> <span class="n">urlopen</span><span class="p">(</span><span class="n">Request</span><span class="p">(</span><span class="n">robots_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">robots_page</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
        <span class="n">line_split</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;sitemap&#39;</span><span class="p">:</span>
            <span class="n">sitemaps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">sitemaps</span>


<span class="k">def</span> <span class="nf">_parse_sitemap</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;loc&#39;</span> <span class="ow">in</span> <span class="n">n</span><span class="o">.</span><span class="n">tag</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">text</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">parse_xml_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">node_url</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="k">nonlocal</span> <span class="n">d</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">tag</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">d</span><span class="p">[</span><span class="n">node_url</span><span class="p">][</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">text</span>
                <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
                <span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span> <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">keys</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="n">element</span><span class="p">):</span>
                <span class="n">parse_xml_node</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">node_url</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">element</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
        <span class="n">node_url</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">node</span> <span class="k">if</span> <span class="s1">&#39;loc&#39;</span> <span class="ow">in</span> <span class="n">n</span><span class="o">.</span><span class="n">tag</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">parse_xml_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">node_url</span><span class="o">=</span><span class="n">node_url</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>


<div class="viewcode-block" id="sitemap_to_df"><a class="viewcode-back" href="../../advertools.sitemaps.html#advertools.sitemaps.sitemap_to_df">[docs]</a><span class="k">def</span> <span class="nf">sitemap_to_df</span><span class="p">(</span><span class="n">sitemap_url</span><span class="p">,</span> <span class="n">max_workers</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve all URLs and other available tags of a sitemap(s) and put them in</span>
<span class="sd">    a DataFrame.</span>

<span class="sd">    You can also pass the URL of a sitemap index, or a link to a robots.txt</span>
<span class="sd">    file.</span>

<span class="sd">    :param url sitemap_url: The URL of a sitemap, either a regular sitemap, a</span>
<span class="sd">                            sitemap index, or a link to a robots.txt file.</span>
<span class="sd">                            In the case of a sitemap index or robots.txt, the</span>
<span class="sd">                            function will go through all the sub sitemaps and</span>
<span class="sd">                            retrieve all the included URLs in one DataFrame.</span>
<span class="sd">    :param int max_workers: The maximum number of workers to use for threading.</span>
<span class="sd">                            The higher the faster, but with high numbers you</span>
<span class="sd">                            risk being blocked and/or missing some data as you</span>
<span class="sd">                            might appear like an attacker.</span>
<span class="sd">    :param bool recursive: Whether or not to follow and import all sub-sitemaps</span>
<span class="sd">                           (in case you have a sitemap index), or to only</span>
<span class="sd">                           import the given sitemap. This might be useful in</span>
<span class="sd">                           case you want to explore what sitemaps are available</span>
<span class="sd">                           after which you can decide which ones you are</span>
<span class="sd">                           interested in.</span>
<span class="sd">    :return sitemap_df: A pandas DataFrame containing all URLs, as well as</span>
<span class="sd">                        other tags if available (``lastmod``, ``changefreq``,</span>
<span class="sd">                        ``priority``, or others found in news, video, or image</span>
<span class="sd">                        sitemaps).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">sitemap_url</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;robots.txt&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">sitemap_to_df</span><span class="p">(</span><span class="n">sitemap</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="n">recursive</span><span class="p">)</span>
                          <span class="k">for</span> <span class="n">sitemap</span> <span class="ow">in</span> <span class="n">_sitemaps_from_robotstxt</span><span class="p">(</span><span class="n">sitemap_url</span><span class="p">)],</span>
                         <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sitemap_url</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;xml.gz&#39;</span><span class="p">):</span>
        <span class="n">xml_text</span> <span class="o">=</span> <span class="n">urlopen</span><span class="p">(</span><span class="n">Request</span><span class="p">(</span><span class="n">sitemap_url</span><span class="p">,</span>
                                   <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;Accept-Encoding&#39;</span><span class="p">:</span> <span class="s1">&#39;gzip&#39;</span><span class="p">,</span>
                                            <span class="s1">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="s1">&#39;advertools-&#39;</span> <span class="o">+</span>
                                                          <span class="n">version</span><span class="p">}))</span>
        <span class="n">resp_headers</span> <span class="o">=</span> <span class="n">xml_text</span><span class="o">.</span><span class="n">getheaders</span><span class="p">()</span>
        <span class="n">xml_text</span> <span class="o">=</span> <span class="n">GzipFile</span><span class="p">(</span><span class="n">fileobj</span><span class="o">=</span><span class="n">xml_text</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xml_text</span> <span class="o">=</span> <span class="n">urlopen</span><span class="p">(</span><span class="n">Request</span><span class="p">(</span><span class="n">sitemap_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">))</span>
        <span class="n">resp_headers</span> <span class="o">=</span> <span class="n">xml_text</span><span class="o">.</span><span class="n">getheaders</span><span class="p">()</span>
    <span class="n">xml_string</span> <span class="o">=</span> <span class="n">xml_text</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">xml_string</span><span class="p">)</span>

    <span class="n">sitemap_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;}&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;sitemapindex&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">recursive</span><span class="p">:</span>
        <span class="n">multi_sitemap_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">sitemap_url_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">elem</span><span class="p">:</span>
                <span class="k">if</span> <span class="s1">&#39;loc&#39;</span> <span class="ow">in</span> <span class="n">el</span><span class="o">.</span><span class="n">tag</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="n">sitemap_url</span><span class="p">:</span>
                        <span class="n">error_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
                            <span class="s1">&#39;sitemap&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">sitemap_url</span><span class="p">],</span>
                            <span class="s1">&#39;errors&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;WARNING: Sitemap contains a link to itself&#39;</span><span class="p">]</span>
                        <span class="p">})</span>
                        <span class="n">multi_sitemap_df</span> <span class="o">=</span> <span class="n">multi_sitemap_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_df</span><span class="p">,</span>
                                                                   <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">sitemap_url_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
            <span class="n">to_do</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">sitemap</span> <span class="ow">in</span> <span class="n">sitemap_url_list</span><span class="p">:</span>
                <span class="n">future</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">sitemap_to_df</span><span class="p">,</span> <span class="n">sitemap</span><span class="p">)</span>
                <span class="n">to_do</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>
            <span class="n">done_iter</span> <span class="o">=</span> <span class="n">futures</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">to_do</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">done_iter</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">multi_sitemap_df</span> <span class="o">=</span> <span class="n">multi_sitemap_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">(),</span>
                                                               <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">error_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)),</span>
                                            <span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                    <span class="n">future_str</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">future</span><span class="p">))</span>
                    <span class="n">hexes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">to_do</span><span class="p">]</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">hexes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">future_str</span><span class="p">)</span>
                    <span class="n">error_df</span><span class="p">[</span><span class="s1">&#39;sitemap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sitemap_url_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">sitemap_url_list</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
                    <span class="n">multi_sitemap_df</span> <span class="o">=</span> <span class="n">multi_sitemap_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">error_df</span><span class="p">,</span>
                                                               <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">multi_sitemap_df</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s1">&#39;Getting &#39;</span> <span class="o">+</span> <span class="n">sitemap_url</span><span class="p">)</span>
        <span class="n">elem_df</span> <span class="o">=</span> <span class="n">_parse_sitemap</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="n">sitemap_df</span> <span class="o">=</span> <span class="n">sitemap_df</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">elem_df</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">sitemap_df</span><span class="p">[</span><span class="s1">&#39;sitemap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">sitemap_url</span><span class="p">]</span> <span class="k">if</span> <span class="n">sitemap_df</span><span class="o">.</span><span class="n">empty</span> <span class="k">else</span> <span class="n">sitemap_url</span>
    <span class="k">if</span> <span class="s1">&#39;lastmod&#39;</span> <span class="ow">in</span> <span class="n">sitemap_df</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sitemap_df</span><span class="p">[</span><span class="s1">&#39;lastmod&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">sitemap_df</span><span class="p">[</span><span class="s1">&#39;lastmod&#39;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">if</span> <span class="s1">&#39;priority&#39;</span> <span class="ow">in</span> <span class="n">sitemap_df</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sitemap_df</span><span class="p">[</span><span class="s1">&#39;priority&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sitemap_df</span><span class="p">[</span><span class="s1">&#39;priority&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="n">etag_lastmod</span> <span class="o">=</span> <span class="p">{</span><span class="n">header</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">):</span> <span class="n">val</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
                    <span class="k">for</span> <span class="n">header</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">resp_headers</span>
                    <span class="k">if</span> <span class="n">header</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;etag&#39;</span><span class="p">,</span> <span class="s1">&#39;last-modified&#39;</span><span class="p">]}</span>
    <span class="n">sitemap_df</span> <span class="o">=</span> <span class="n">sitemap_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="n">etag_lastmod</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;last_modified&#39;</span> <span class="ow">in</span> <span class="n">sitemap_df</span><span class="p">:</span>
        <span class="n">sitemap_df</span><span class="p">[</span><span class="s1">&#39;sitemap_last_modified&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">sitemap_df</span><span class="p">[</span><span class="s1">&#39;last_modified&#39;</span><span class="p">])</span>
        <span class="k">del</span> <span class="n">sitemap_df</span><span class="p">[</span><span class="s1">&#39;last_modified&#39;</span><span class="p">]</span>
    <span class="n">sitemap_df</span><span class="p">[</span><span class="s1">&#39;sitemap_size_mb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xml_string</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span>
    <span class="n">sitemap_df</span><span class="p">[</span><span class="s1">&#39;download_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">tz</span><span class="o">=</span><span class="s1">&#39;UTC&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sitemap_df</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Elias Dabbas.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>